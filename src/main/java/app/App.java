/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package app;

import client.Client;
import console.Console;
import controller.Controller;
import vue.MainWindowJFrame;
import vue.composant.FlatComboBox;
import vue.panel.ResearchPanel;
import vue.utils.Props;

import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStream;

import javax.swing.*;
import javax.json.*;

public class App {
    /**
     * The host to connect to.
     */
    private static final String HOST;
    /**
     * The port to connect to.
     */
    private static final int PORT;

    static {
        try (InputStream stream = App.class.getResourceAsStream("/config/network.json")) {
            // Création d'un objet JsonReader
            JsonReader jsonReader = Json.createReader(stream);
            // Récupération de l'objet racine JSON
            JsonObject jsonObject = jsonReader.readObject();
   
            // Récupération des champs du fichier JSON
            HOST = jsonObject.getString("host");
            PORT = jsonObject.getInt("port");
            System.out.println("host: " + HOST + " port: " + PORT);
        } catch (IOException e) {
            throw new ExceptionInInitializerError(e);
        }
    }

    public static void main(String[] args) {
        ResearchPanel researchPanel = new ResearchPanel();
        researchPanel.setOpaque(false);
        researchPanel.setLayout(new BoxLayout(researchPanel, BoxLayout.Y_AXIS));
        FlatComboBox stationDepartList = new FlatComboBox(Props.depart);
        FlatComboBox stationArriveList = new FlatComboBox(Props.arrive);
        Client client = new Client(HOST, PORT, researchPanel, stationDepartList, stationArriveList);
        Controller controller = new Controller(client);
        researchPanel.addObserver(client);
        stationDepartList.addObserver(client);
        stationArriveList.addObserver(client);
        if (client.isConnected()) {
            client.start();
            SwingUtilities.invokeLater(() -> new MainWindowJFrame(controller, researchPanel, stationDepartList, stationArriveList));
            new Console(client).start();
        } else {
            new Console(null).start();
        }
    }
}
